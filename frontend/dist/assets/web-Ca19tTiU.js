import{c as w}from"./index-EaSHOMea.js";const C=async e=>new Promise((t,o)=>{const n=new FileReader;n.onload=()=>{const s=n.result,c=s.substr(s.indexOf(",")+1);t(c)},n.onerror=s=>o(s),n.readAsDataURL(e)}),f=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),k=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),j=(e,t,o={})=>{const n=f(e),s=f(t),c=`; expires=${(o.expires||"").replace("expires=","")}`,a=(o.path||"/").replace("path=","");document.cookie=`${n}=${s||""}${c}; path=${a}`},p=()=>{const e=[],t={};if(!document.cookie)return e;const o=document.cookie.split(";")||[];for(const s of o){let[c,a]=s.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");c=k(c).trim(),a=k(a).trim(),t[c]=a}const n=Object.entries(t);for(const[s,c]of n)e.push({key:s,value:c});return e},x=e=>{const t=p();for(const o of t)if(o.key===e)return o;return{key:e,value:""}},$=e=>{document.cookie=`${e}=; Max-Age=0`},m=()=>{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)},v=(e={})=>{const t=Object.keys(e);return Object.keys(e).map(s=>s.toLocaleLowerCase()).reduce((s,c,a)=>(s[c]=e[t[a]],s),{})},E=(e,t=!0)=>e?Object.entries(e).reduce((n,s)=>{const[c,a]=s;let r,i;return Array.isArray(a)?(i="",a.forEach(d=>{r=t?encodeURIComponent(d):d,i+=`${c}=${r}&`}),i.slice(0,-1)):(r=t?encodeURIComponent(a):a,i=`${c}=${r}`),`${n}&${i}`},"").substr(1):null,g=(e,t={})=>{const o=Object.assign({method:e.method||"GET",headers:e.headers},t),s=v(e.headers)["content-type"]||"";if(typeof e.data=="string")o.body=e.data;else if(s.includes("application/x-www-form-urlencoded")){const c=new URLSearchParams;for(const[a,r]of Object.entries(e.data||{}))c.set(a,r);o.body=c.toString()}else if(s.includes("multipart/form-data")){const c=new FormData;if(e.data instanceof FormData)e.data.forEach((r,i)=>{c.append(i,r)});else for(let r of Object.keys(e.data))c.append(r,e.data[r]);o.body=c;const a=new Headers(o.headers);a.delete("content-type"),o.headers=a}else(s.includes("application/json")||typeof e.data=="object")&&(o.body=JSON.stringify(e.data));return o},l=async e=>{const t=g(e,e.webFetchExtra),o=E(e.params,e.shouldEncodeUrlParams),n=o?`${e.url}?${o}`:e.url,s=await fetch(n,t),c=s.headers.get("content-type")||"";let{responseType:a="text"}=s.ok?e:{};c.includes("application/json")&&(a="json");let r;switch(a){case"arraybuffer":case"blob":const d=await s.blob();r=await C(d);break;case"json":r=await s.json();break;case"document":case"text":default:r=await s.text()}const i={};return s.headers.forEach((d,h)=>{i[h]=d}),{data:r,headers:i,status:s.status,url:s.url}},A=async e=>l(Object.assign(Object.assign({},e),{method:"GET"})),P=async e=>l(Object.assign(Object.assign({},e),{method:"POST"})),T=async e=>l(Object.assign(Object.assign({},e),{method:"PUT"})),U=async e=>l(Object.assign(Object.assign({},e),{method:"PATCH"})),I=async e=>l(Object.assign(Object.assign({},e),{method:"DELETE"}));class D extends w{constructor(){super(),this.request=async t=>l(t),this.get=async t=>A(t),this.post=async t=>P(t),this.put=async t=>T(t),this.patch=async t=>U(t),this.del=async t=>I(t),this.getCookiesMap=async t=>{const o=p(),n={};for(const s of o)n[s.key]=s.value;return n},this.getCookies=async t=>{const{url:o}=t;return{cookies:p()}},this.setCookie=async t=>{const{key:o,value:n,expires:s="",path:c=""}=t;j(o,n,{expires:s,path:c})},this.getCookie=async t=>x(t.key),this.deleteCookie=async t=>$(t.key),this.clearCookies=async t=>m(),this.clearAllCookies=async()=>m(),this.uploadFile=async t=>{const o=new FormData;o.append(t.name,t.blob||"undefined");const n=Object.assign(Object.assign({},t),{body:o,method:"POST"});return this.post(n)},this.downloadFile=async t=>{const o=g(t,t.webFetchExtra),n=await fetch(t.url,o);let s;if(!(t!=null&&t.progress))s=await n.blob();else if(!(n!=null&&n.body))s=new Blob;else{const c=n.body.getReader();let a=0,r=[];const i=n.headers.get("content-type"),d=parseInt(n.headers.get("content-length")||"0",10);for(;;){const{done:u,value:y}=await c.read();if(u)break;r.push(y),a+=(y==null?void 0:y.length)||0;const O={type:"DOWNLOAD",url:t.url,bytes:a,contentLength:d};this.notifyListeners("progress",O)}let h=new Uint8Array(a),b=0;for(const u of r)typeof u>"u"||(h.set(u,b),b+=u.length);s=new Blob([h.buffer],{type:i||void 0})}return{blob:s}}}}export{D as HttpWeb};
